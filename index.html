<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Purple Phrasal Notebook ‚òÇÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&family=Kodchasan:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f3e5f5;
            --card-bg: #ffffff;
            --primary: #ce93d8;
            --secondary: #ab47bc;
            --highlight: #fff9c4;
            --text: #4a148c;
            --nav-bg: #8e24aa;
        }

        body {
            font-family: 'Mali', cursive;
            background-color: var(--bg-color);
            background-image: radial-gradient(#e1bee7 15%, transparent 16%);
            background-size: 25px 25px;
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 100px; /* Space for fixed nav */
        }

        /* --- NAVIGATION --- */
        .navbar {
            position: fixed;
            top: 20px;
            z-index: 1000;
            background: white;
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex;
            gap: 20px;
            border: 3px solid var(--secondary);
        }

        .nav-btn {
            background: none;
            border: none;
            font-family: 'Mali', cursive;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--secondary);
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 20px;
            transition: 0.3s;
        }

        .nav-btn.active, .nav-btn:hover {
            background-color: var(--primary);
            color: white;
        }

        /* --- TOOLBAR (Formatting) --- */
        .toolbar {
            margin-bottom: 20px;
            background: rgba(255,255,255,0.8);
            padding: 5px 15px;
            border-radius: 30px;
            display: flex;
            gap: 10px;
        }
        .tool-btn {
            background: none; border: none; cursor: pointer; font-size: 1.1rem;
            font-weight: bold; padding: 5px; border-radius: 5px; transition: 0.2s;
        }
        .tool-btn:hover { background-color: #e1bee7; }

        /* --- CONTAINERS --- */
        .view-section {
            width: 100%;
            max-width: 800px;
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s;
        }
        .view-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- EDITOR STYLES --- */
        .form-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(142, 36, 170, 0.15);
            border: 4px solid #fff;
        }

        .section-header {
            background-color: var(--primary); color: white; padding: 10px 20px;
            border-radius: 15px; margin: 30px 0 15px 0; font-size: 1.2rem;
            text-align: center; box-shadow: 0 4px 0 #9c27b0;
        }

        .sub-group {
            border: 2px dashed #e1bee7; border-radius: 15px; padding: 15px;
            margin-bottom: 15px; background: #fffcf4;
        }

        .rich-input {
            width: 100%; min-height: 40px; padding: 10px;
            border: 2px solid #e1bee7; border-radius: 12px;
            background: #fff; font-family: 'Kodchasan', sans-serif;
            outline: none; margin-bottom: 10px; color: #333;
        }
        .rich-input:focus { border-color: var(--secondary); background: #fdfbff; }

        .gif-wrapper { text-align: center; margin-bottom: 15px; }
        .gif-input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 5px; }
        .preview-img { max-width: 200px; border-radius: 10px; display: none; margin: 5px auto; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* --- BUTTONS --- */
        .btn-group { display: flex; gap: 15px; margin-top: 20px; }
        .btn-save {
            flex: 2; background: var(--secondary); color: white; border: none; padding: 15px;
            border-radius: 50px; font-family: 'Mali', cursive; font-size: 1.3rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 0 #7b1fa2; transition: 0.2s;
        }
        .btn-next {
            flex: 1; background: #fff; color: var(--secondary); border: 3px solid var(--secondary);
            padding: 15px; border-radius: 50px; font-family: 'Mali', cursive; font-size: 1.3rem;
            font-weight: bold; cursor: pointer; box-shadow: 0 6px 0 #e1bee7; transition: 0.2s;
        }
        .btn-save:hover, .btn-next:hover { transform: translateY(-2px); filter: brightness(1.05); }
        .btn-save:active, .btn-next:active { transform: translateY(4px); box-shadow: none; }

        /* --- GALLERY STYLES --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .gallery-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid white;
            transition: 0.3s;
            cursor: pointer;
            position: relative;
        }
        .gallery-card:hover { transform: translateY(-5px); border-color: var(--primary); }

        .card-img {
            width: 100%; height: 180px; object-fit: cover; background: #f3e5f5;
            display: flex; align-items: center; justify-content: center; color: #aaa;
        }
        .card-content { padding: 15px; }
        .card-title { font-size: 1.4rem; color: var(--secondary); font-weight: bold; margin-bottom: 10px; }
        .card-meaning { font-family: 'Kodchasan', sans-serif; color: #444; font-size: 0.95rem; margin-bottom: 8px; }
        .card-example { font-family: 'Kodchasan', sans-serif; color: #777; font-style: italic; font-size: 0.9rem; }
        .btn-delete {
            position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.8);
            border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;
            color: red; font-weight: bold; display: flex; align-items: center; justify-content: center;
        }
        .btn-delete:hover { background: red; color: white; }

        /* --- MODAL (Full View) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(74, 20, 140, 0.5); z-index: 2000;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: #fff; width: 100%; max-width: 700px; max-height: 90vh;
            overflow-y: auto; border-radius: 20px; padding: 30px;
            position: relative; border: 5px solid var(--secondary);
            animation: popIn 0.3s;
        }
        .close-modal {
            position: absolute; top: 15px; right: 20px; font-size: 2rem;
            cursor: pointer; color: var(--secondary);
        }
        
        /* Modal Result Styles */
        .modal-word { text-align: center; font-size: 2rem; color: var(--secondary); margin-bottom: 20px; border-bottom: 2px dashed #ddd; }
        .modal-row { display: flex; margin-bottom: 8px; align-items: baseline; }
        .modal-label { font-weight: bold; color: var(--secondary); min-width: 100px; }
        .modal-val { font-family: 'Kodchasan', sans-serif; flex: 1; }
        .modal-gif { width: 100%; max-width: 300px; border-radius: 10px; margin: 10px auto; display: block; }
        .modal-section { background: #f8f0fb; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary); }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

    <div class="navbar">
        <button class="nav-btn active" onclick="switchView('add')">‚úèÔ∏è ‡∏à‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</button>
        <button class="nav-btn" onclick="switchView('gallery')">üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (Gallery)</button>
    </div>

    <div class="toolbar">
        <span style="color:#888; font-size:0.9rem;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:</span>
        <button class="tool-btn" onclick="document.execCommand('bold')"><b>B</b></button>
        <button class="tool-btn" onclick="document.execCommand('foreColor', false, '#d81b60')" style="color:#d81b60">A</button>
        <button class="tool-btn" onclick="document.execCommand('foreColor', false, '#7b1fa2')" style="color:#7b1fa2">A</button>
        <button class="tool-btn" onclick="document.execCommand('hiliteColor', false, '#fff9c4')" style="background:#fff9c4">H</button>
    </div>

    <div id="view-add" class="view-section active">
        <div class="form-card">
            <h2 style="text-align: center; color: var(--secondary);">‚ú® New Entry ‚ú®</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <label>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå / Phrasal Verb (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥)</label>
                <div class="rich-input" id="main-word" contenteditable="true" style="font-size: 1.5rem; text-align: center;"></div>
            </div>

            <div id="form-sections"></div>

            <div class="sub-group" style="background: #fdf5e6;">
                <label>GRAMMAR</label><div class="rich-input" id="grammar" contenteditable="true"></div>
                <label>DERIVE WORDS</label><div class="rich-input" id="derive" contenteditable="true"></div>
                <label>WORD FAMILY</label><div class="rich-input" id="family" contenteditable="true"></div>
                <label>SYN/OP</label><div class="rich-input" id="synop" contenteditable="true"></div>
                <label>SYNTAX</label><div class="rich-input" id="syntax" contenteditable="true"></div>
                <label>FYI</label><div class="rich-input" id="fyi" contenteditable="true"></div>
            </div>

            <div class="btn-group">
                <button class="btn-save" onclick="saveEntry()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Save)</button>
                <button class="btn-next" onclick="clearForm()">‚û°Ô∏è ‡∏Ñ‡∏≥‡∏ï‡πà‡∏≠‡πÑ‡∏õ (Next)</button>
            </div>
        </div>
    </div>

    <div id="view-gallery" class="view-section">
        <h1 style="text-align: center; color: var(--secondary);">üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
        <div class="gallery-grid" id="gallery-container">
            </div>
    </div>

    <div class="modal-overlay" id="detail-modal" onclick="closeModal(event)">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('detail-modal').style.display='none'">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // --- 1. INITIALIZATION & UI GENERATION ---
        
        // Generate Section 1-4 HTML automatically to keep code clean
        function generateSections() {
            const container = document.getElementById('form-sections');
            let html = '';
            for (let i = 1; i <= 4; i++) {
                html += `
                <div class="section-header">üíú Section ${i}</div>
                <div class="gif-wrapper">
                    <input type="text" class="gif-input" id="gif${i}" placeholder="üîó ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå GIF Section ${i}" oninput="previewGif(${i})">
                    <img id="prev${i}" class="preview-img" onerror="this.style.display='none'">
                </div>
                <div class="sub-group">
                    <label>STRUCTURE ${i}</label><div class="rich-input" id="s${i}-struct" contenteditable="true"></div>
                    ${i === 3 ? `<label>MEANING 3</label><div class="rich-input" id="s${i}-mean" contenteditable="true"></div>` : ''}
                    <label>EN ${i}</label><div class="rich-input" id="s${i}-en" contenteditable="true"></div>
                    ${[1,2,3,4,5].map(n => `<label>TH ${i}.${n}</label><div class="rich-input" id="s${i}-th${n}" contenteditable="true"></div>`).join('')}
                </div>`;
                
                if (i <= 3) { // Section 4 has no EX. based on requirements (or add if needed)
                     html += `<div class="sub-group">
                        ${[1,2,3,4].map(n => `<label>EX.${n}</label><div class="rich-input" id="s${i}-ex${n}" contenteditable="true"></div>`).join('')}
                    </div>`;
                }
            }
            container.innerHTML = html;
        }
        generateSections();

        // --- 2. LOGIC FUNCTIONS ---

        // Preview GIF
        function previewGif(index) {
            const url = document.getElementById(`gif${index}`).value.trim();
            const img = document.getElementById(`prev${index}`);
            if(url) { img.src = url; img.style.display = 'block'; }
            else { img.style.display = 'none'; }
        }

        // Switch View
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`view-${viewName}`).classList.add('active');
            
            // Update Active Button
            const btnIndex = viewName === 'add' ? 0 : 1;
            document.getElementsByClassName('nav-btn')[btnIndex].classList.add('active');

            if(viewName === 'gallery') renderGallery();
        }

        // --- 3. DATA HANDLING (LOCAL STORAGE) ---

        function getVal(id) { return document.getElementById(id) ? document.getElementById(id).innerHTML : ''; }
        function getLink(id) { return document.getElementById(id).value; }

        function saveEntry() {
            const mainWord = getVal('main-word');
            if(!mainWord.trim()) { alert("‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡πâ‡∏≤ ü•∫"); return; }

            // Collect Data Object
            const entry = {
                id: Date.now(),
                mainWord: mainWord,
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á Object
                sections: [],
                extras: {
                    grammar: getVal('grammar'),
                    derive: getVal('derive'),
                    family: getVal('family'),
                    synop: getVal('synop'),
                    syntax: getVal('syntax'),
                    fyi: getVal('fyi')
                }
            };

            for(let i=1; i<=4; i++) {
                entry.sections.push({
                    gif: getLink(`gif${i}`),
                    struct: getVal(`s${i}-struct`),
                    mean: document.getElementById(`s${i}-mean`) ? getVal(`s${i}-mean`) : '',
                    en: getVal(`s${i}-en`),
                    ths: [1,2,3,4,5].map(n => getVal(`s${i}-th${n}`)),
                    exs: [1,2,3,4].map(n => document.getElementById(`s${i}-ex${n}`) ? getVal(`s${i}-ex${n}`) : '')
                });
            }

            // Save to LocalStorage
            const existingData = JSON.parse(localStorage.getItem('myPurpleVocab') || '[]');
            existingData.unshift(entry); // Add to top
            localStorage.setItem('myPurpleVocab', JSON.stringify(existingData));

            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! üíú");
            switchView('gallery'); // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Gallery ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢)
        }

        function clearForm() {
            document.querySelectorAll('.rich-input').forEach(el => el.innerHTML = '');
            document.querySelectorAll('input').forEach(el => el.value = '');
            document.querySelectorAll('.preview-img').forEach(el => el.style.display = 'none');
            window.scrollTo(0,0);
        }

        // --- 4. GALLERY & RENDERING ---

        function renderGallery() {
            const data = JSON.parse(localStorage.getItem('myPurpleVocab') || '[]');
            const container = document.getElementById('gallery-container');
            
            if(data.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#aaa;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏•‡∏¢ ‡πÑ‡∏õ‡∏à‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞! üìù</div>';
                return;
            }

            container.innerHTML = data.map(item => {
                // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å (‡∏£‡∏π‡∏õ‡πÅ‡∏£‡∏Å, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏Å TH 1.1, ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏£‡∏Å EX.1)
                const firstGif = item.sections.find(s => s.gif)?.gif || ''; 
                const firstMeaning = item.sections[0].ths[0] || item.sections[0].en || 'No definition';
                const firstEx = item.sections[0].exs[0] || '';

                // HTML Card
                return `
                <div class="gallery-card" onclick="openDetail(${item.id})">
                    <button class="btn-delete" onclick="deleteItem(event, ${item.id})">√ó</button>
                    <div class="card-img">
                        ${firstGif ? `<img src="${firstGif}" style="width:100%; height:100%; object-fit:cover;">` : '<span>No GIF üéûÔ∏è</span>'}
                    </div>
                    <div class="card-content">
                        <div class="card-title">${item.mainWord}</div>
                        <div class="card-meaning">üìå ${stripTags(firstMeaning).substring(0, 50)}...</div>
                        <div class="card-example">üí¨ "${stripTags(firstEx).substring(0, 60)}..."</div>
                    </div>
                </div>`;
            }).join('');
        }

        function stripTags(html) {
            let tmp = document.createElement("DIV");
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || "";
        }

        function deleteItem(e, id) {
            e.stopPropagation(); // Prevent card click
            if(!confirm("‡∏à‡∏∞‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏£‡∏≠‡∏Ñ‡∏∞? ü•∫")) return;

            const data = JSON.parse(localStorage.getItem('myPurpleVocab') || '[]');
            const newData = data.filter(item => item.id !== id);
            localStorage.setItem('myPurpleVocab', JSON.stringify(newData));
            renderGallery();
        }

        // --- 5. MODAL DETAIL VIEW ---

        function openDetail(id) {
            const data = JSON.parse(localStorage.getItem('myPurpleVocab') || '[]');
            const item = data.find(i => i.id === id);
            if(!item) return;

            let html = `<div class="modal-word">${item.mainWord}</div>`;

            // Loop Sections
            item.sections.forEach((sec, idx) => {
                let secHtml = '';
                // Check if section has meaningful content to display
                const hasContent = sec.gif || sec.struct || sec.en || sec.ths.some(t=>t) || sec.exs.some(e=>e);
                
                if(hasContent) {
                    secHtml += `<div class="modal-section">`;
                    if(sec.gif) secHtml += `<img src="${sec.gif}" class="modal-gif">`;
                    if(sec.struct) secHtml += rowHTML(`STRUCTURE ${idx+1}`, sec.struct);
                    if(sec.mean) secHtml += rowHTML(`MEANING ${idx+1}`, sec.mean);
                    if(sec.en) secHtml += rowHTML(`EN ${idx+1}`, sec.en);
                    sec.ths.forEach((th, i) => { if(th) secHtml += rowHTML(`TH ${idx+1}.${i+1}`, th); });
                    sec.exs.forEach((ex, i) => { if(ex) secHtml += rowHTML(`EX.${i+1}`, ex); });
                    secHtml += `</div>`;
                }
                html += secHtml;
            });

            // Extra Info
            const ex = item.extras;
            if(ex.grammar || ex.derive || ex.family || ex.synop || ex.syntax || ex.fyi) {
                html += `<div class="modal-section" style="background:#fffcf4; border-color:#ffca28;">`;
                if(ex.grammar) html += rowHTML('GRAMMAR', ex.grammar);
                if(ex.derive) html += rowHTML('DERIVE', ex.derive);
                if(ex.family) html += rowHTML('FAMILY', ex.family);
                if(ex.synop) html += rowHTML('SYN/OP', ex.synop);
                if(ex.syntax) html += rowHTML('SYNTAX', ex.syntax);
                if(ex.fyi) html += rowHTML('FYI', ex.fyi);
                html += `</div>`;
            }

            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('detail-modal').style.display = 'flex';
        }

        function rowHTML(label, val) {
            return `<div class="modal-row"><div class="modal-label">${label}</div><div class="modal-val">${val}</div></div>`;
        }

        function closeModal(e) {
            if(e.target.id === 'detail-modal') document.getElementById('detail-modal').style.display = 'none';
        }

    </script>
</body>
</html>
